<div id="tag-count-<%= contact_line.id %>" class="tag-count"><span id="tag-count-count-<%= contact_line.id %>"><%= contact_line.tags.count.to_s %></span> tag(s)</div>
<% if standalone %>
  <%= form_remote_tag :url => url_for(:controller => '/admin/contact', :action => :manage_tags, :id => contact_line), :update => "tag-details-#{contact_line.id}" %>
<% end %>
<h3>Existing Tags:</h3>
<ul class="pui-autocomplete-holder" style="border: none;" id="existing-tags-<%= contact_line.id %>">
  <%= render :partial => 'shared/existing_tags', :collection => contact_line.tags, :locals => {:object_id => contact_line.id, :param_name => 'contact[tag_ids][]'} %>
</ul>
<h3>Add tags to this contact:</h3>
<p class="field"><%= text_field_tag 'new_tags', {}, {:id =>  'new_tags-' + contact_line.id.to_s} %></p>
<% if standalone %>
  <%= submit_tag 'Save changes to tags' %>
</form>
<% end %>
<script type="text/javascript">
  <% unless request.xhr? %>
    document.observe('dom:loaded',function(){
  <% end %>
  ac = new UI.AutoComplete('new_tags-<%= contact_line.id %>',{shadow: "auto_complete", tokens: ',', url: '<%= url_for :controller => '/admin/tag', :action => :json_tags %>' });
  ac.observe('input:empty', function(event) {event.memo.autocomplete.showMessage("Type a tag. New tags should be comma-separated.")})
  .observe('selection:empty', function(event) {event.memo.autocomplete.showMessage("Nothing found")});
  <% unless request.xhr? %>
    });
  <% end %>
</script>
<% if request.xhr? %>
  <%= javascript_tag(visual_effect(:pulsate, "tag-count-#{contact_line.id}")) %>
<% end %>
